"use strict";(self.webpackChunkpixel_pace=self.webpackChunkpixel_pace||[]).push([[138],{9138:function(e,t,n){n.r(t),n.d(t,{default:function(){return L}});var s=n(5712),r=n(5892),o=n(9439),i=n(2517),a=n(580),l=n(3520),c=n(7412),u=n(2791),p=n(1255),x=n(6011),f=n(4942),d=n(1413),h=function(e,t){var n=(0,u.useState)({}),s=(0,o.Z)(n,2),r=s[0],i=s[1];return(0,u.useEffect)((function(){var e=function(e){i((function(t){return(0,d.Z)((0,d.Z)({},t),{},(0,f.Z)({},e.key.toLowerCase(),!0))}))},t=function(e){i((function(t){return(0,d.Z)((0,d.Z)({},t),{},(0,f.Z)({},e.key.toLowerCase(),!1))}))};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),function(){window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}}),[]),(0,u.useEffect)((function(){if(e&&t){if(r.w?(e.applyEngineForce(150,2),e.applyEngineForce(150,3)):r.s?(e.applyEngineForce(-150,2),e.applyEngineForce(-150,3)):(e.applyEngineForce(0,2),e.applyEngineForce(0,3)),r.a)e.setSteeringValue(.35,2),e.setSteeringValue(.35,3),e.setSteeringValue(-.1,0),e.setSteeringValue(-.1,1);else if(r.d)e.setSteeringValue(-.35,2),e.setSteeringValue(-.35,3),e.setSteeringValue(.1,0),e.setSteeringValue(.1,1);else for(var n=0;n<4;n++)e.setSteeringValue(0,n);r.arrowdown&&t.applyLocalImpulse([0,-5,0],[0,0,1]),r.arrowup&&t.applyLocalImpulse([0,-5,0],[0,0,-1]),r.arrowleft&&t.applyLocalImpulse([0,-5,0],[-.5,0,0]),r.arrowright&&t.applyLocalImpulse([0,-5,0],[.5,0,0]),r.r&&(t.position.set(-1.5,.5,3),t.velocity.set(0,0,0),t.angularVelocity.set(0,0,0),t.rotation.set(0,0,0))}}),[r,e,t]),r},m=n(184),g=function(e){var t=e.thirdPerson,n=e.mesh,r=[-1.5,.5,3],i=[.15,.07,.3],a=(0,s.EJ)((function(){return{allowSleep:!1,args:i,mass:150,position:r}}),(0,u.useRef)(null)),l=(0,o.Z)(a,2),x=l[0],f=l[1];(0,u.useEffect)((function(){n.scale.set(.0012,.0012,.0012),n.children[0].position.set(-365,-18,-67)}),[n]);var g=function(e,t,n,r){var o=[(0,u.useRef)(null),(0,u.useRef)(null),(0,u.useRef)(null),(0,u.useRef)(null)],i={radius:r,directionLocal:[0,-1,0],axleLocal:[1,0,0],suspensionStiffness:60,suspensionRestLength:.1,frictionSlip:5,dampingRelaxation:2.3,dampingCompression:4.4,maxSuspensionForce:1e5,rollInfluence:.01,maxSuspensionTravel:.1,customSlidingRotationalSpeed:-30,useCustomSlidingRotationalSpeed:!0},a=[(0,d.Z)((0,d.Z)({},i),{},{chassisConnectionPointLocal:[.65*-e,.4*t,n],isFrontWheel:!0}),(0,d.Z)((0,d.Z)({},i),{},{chassisConnectionPointLocal:[.65*e,.4*t,n],isFrontWheel:!0}),(0,d.Z)((0,d.Z)({},i),{},{chassisConnectionPointLocal:[.65*-e,.4*t,-n],isFrontWheel:!1}),(0,d.Z)((0,d.Z)({},i),{},{chassisConnectionPointLocal:[.65*e,.4*t,-n],isFrontWheel:!1})],l=function(){return{collisionFilterGroup:0,mass:1,shapes:[{args:[i.radius,i.radius,.015,16],rotation:[0,0,-Math.PI/2],type:"Cylinder"}],type:"Kinematic"}};return(0,s.rQ)(l,o[0]),(0,s.rQ)(l,o[1]),(0,s.rQ)(l,o[2]),(0,s.rQ)(l,o[3]),[o,a]}(.15,.07,.15,.05),j=(0,o.Z)(g,2),y=j[0],v=j[1],w=(0,s.b6)((function(){return{chassisBody:x,wheelInfos:v,wheels:y}}),(0,u.useRef)(null)),S=(0,o.Z)(w,2),E=S[0],L=S[1];return h(L,f),(0,c.z)((function(e){if(t&&x.current){var n=new p.Vector3(0,0,0);n.setFromMatrixPosition(x.current.matrixWorld);var s=new p.Quaternion(0,0,0,0);s.setFromRotationMatrix(x.current.matrixWorld);var r=new p.Vector3(0,0,1);r.applyQuaternion(s),r.normalize();var o=n.clone().add(r.clone().multiplyScalar(1).add(new p.Vector3(0,.3,0)));r.add(new p.Vector3(0,.2,0)),e.camera.position.copy(o),e.camera.lookAt(n)}})),(0,m.jsx)("group",{ref:E,name:"vehicle",children:(0,m.jsx)("group",{ref:x,name:"chassisBody",children:(0,m.jsx)("primitive",{object:n,"rotation-y":Math.PI,position:[0,-.09,0]})})})},j=n(8843),y=function(e){var t=e.alphaMap,n=e.aoMap,r=e.gridMap;(0,s.xK)((function(){return{type:"Static",rotation:[-Math.PI/2,0,0]}}),(0,u.useRef)(null));var o=(0,u.useRef)(null),i=(0,u.useRef)(null);return(0,u.useEffect)((function(){r&&(r.anisotropy=16)}),[r]),(0,u.useEffect)((function(){if(o.current&&i.current){var e=o.current.geometry.attributes.uv.array;o.current.geometry.setAttribute("uv2",new p.BufferAttribute(e,2));var t=i.current.geometry.attributes.uv.array;i.current.geometry.setAttribute("uv2",new p.BufferAttribute(t,2))}}),[o,i]),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("mesh",{ref:i,position:[-2.285,-.01,-1.325],"rotation-x":.5*-Math.PI,children:[(0,m.jsx)("planeGeometry",{args:[12,12]}),(0,m.jsx)("meshBasicMaterial",{opacity:.325,alphaMap:r,transparent:!0,color:"white"})]}),(0,m.jsxs)("mesh",{ref:o,position:[-2.285,-.015,-1.325],"rotation-x":.5*-Math.PI,"rotation-z":-.079,children:[(0,m.jsx)("circleGeometry",{args:[6.12,50]}),(0,m.jsx)(j.Q,{aoMap:n,alphaMap:t,transparent:!0,color:[.5,.5,.5],envMapIntensity:.35,metalness:.05,roughness:.4,dithering:!0,blur:[1024,512],mixBlur:3,mixStrength:30,mixContrast:1,resolution:1024,mirror:0,depthScale:0,minDepthThreshold:.9,maxDepthThreshold:1,depthToBlurRatioBias:.25,reflectorOffset:.02})]})]})},v=function(e){var t=e.position,n=e.scale;return(0,s.EJ)((function(){return{args:n,position:t,type:"Static"}})),null},w=function(e){var t=e.rampResult.scene.children[0].geometry,n=t.attributes.position.array,r=t.index.array;return(0,s.zO)((function(){return{args:[n,r],mass:0,type:"Static"}}),(0,u.useRef)(null)),null},S=function(e){var t=e.colorMap,n=e.result,s=e.rampResult;(0,u.useEffect)((function(){t&&(t.anisotropy=16)}),[t]);var r=n.scene.children[0].geometry;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("mesh",{geometry:r,children:(0,m.jsx)("meshBasicMaterial",{toneMapped:!1,map:t})}),(0,m.jsx)(v,{position:[1.75,0,.5],scale:[.3,1,.3]}),(0,m.jsx)(v,{position:[2.5,0,-1.4],scale:[.3,1,.3]}),(0,m.jsx)(v,{position:[.6,0,-3.8],scale:[.3,1,.3]}),(0,m.jsx)(v,{position:[-1.95,0,-5.18],scale:[.3,1,.3]}),(0,m.jsx)(v,{position:[-5.55,0,-3.05],scale:[.3,1,.3]}),(0,m.jsx)(v,{position:[-4.4,0,-1.77],scale:[.3,1,.3]}),(0,m.jsx)(v,{position:[-7.03,0,-.76],scale:[.3,1,.3]}),(0,m.jsx)(v,{position:[-4.75,0,2.73],scale:[.3,1,.3]}),(0,m.jsx)(v,{position:[-3.05,0,3.4],scale:[.3,1,.3]}),(0,m.jsx)(v,{position:[-.83,0,3.2],scale:[.3,1,.3]}),(0,m.jsx)(v,{position:[-1.85,0,.385],scale:[.05,1,.13]}),(0,m.jsx)(v,{position:[-1.85,0,-.385],scale:[.05,1,.13]}),(0,m.jsx)(v,{position:[-2.28,0,.385],scale:[.05,1,.13]}),(0,m.jsx)(v,{position:[-2.28,0,-.385],scale:[.05,1,.13]}),(0,m.jsx)(v,{position:[-4.39,0,1.125],scale:[.13,1,.13]}),(0,m.jsx)(v,{position:[-4.39,0,1.9],scale:[.13,1,.13]}),(0,m.jsx)(v,{position:[-2.86,0,-.9],scale:[.35,1,.35]}),(0,m.jsx)(v,{position:[-3.33,0,-.9],scale:[.35,1,.35]}),(0,m.jsx)(v,{position:[.41,0,2],scale:[.35,1,.35]}),(0,m.jsx)(v,{position:[-2.3,0,-2.76],scale:[1.37,1,1.09]}),(0,m.jsx)(v,{position:[-3.08,0,.89],scale:[.36,1,.03]}),(0,m.jsx)(v,{position:[-2.53,0,.89],scale:[.36,1,.03]}),(0,m.jsx)(v,{position:[-4.53,0,-.65],scale:[.1,.5,.1]}),(0,m.jsx)(v,{position:[-4.15,0,-.67],scale:[.1,.5,.1]}),(0,m.jsx)(v,{position:[-4.9,0,-.58],scale:[.1,.5,.1]}),(0,m.jsx)(v,{position:[-.3,0,1],scale:[.1,.5,.1]}),(0,m.jsx)(w,{rampResult:s})]})},E=function(){var e=(0,u.useState)(!1),t=(0,o.Z)(e,2),n=t[0],s=t[1],r=(0,u.useState)([-6,3.9,6.21]),f=(0,o.Z)(r,2)[1],d=(0,c.C)(x.E,"/pixel-pace/models/car.glb").scene,h=(0,c.C)(p.TextureLoader,"/pixel-pace/textures/grid.png"),j=(0,c.C)(p.TextureLoader,"/pixel-pace/textures/ground-ao.png"),v=(0,c.C)(p.TextureLoader,"/pixel-pace/textures/alpha-map.png"),w=(0,c.C)(x.E,"/pixel-pace/models/track.glb"),E=(0,c.C)(p.TextureLoader,"/pixel-pace/textures/track.png"),L=(0,c.C)(x.E,"/pixel-pace/models/ramp.glb");return(0,u.useEffect)((function(){function e(e){"k"===e.key&&(n&&f([-6,3.9,6.21+.01*Math.random()]),s(!n))}return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}}),[n]),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(i.qA,{files:"/pixel-pace/textures/envmap.hdr",background:"both"}),(0,m.jsx)(a.c,{makeDefault:!0,position:[-6,3.9,6.21],fov:40}),!n&&(0,m.jsx)(l.z,{target:[-2.64,-.71,.03]}),(0,m.jsx)(y,{gridMap:h,aoMap:j,alphaMap:v}),(0,m.jsx)(S,{rampResult:L,result:w,colorMap:E}),(0,m.jsx)(g,{thirdPerson:n,mesh:d})]})},L=(n(5215),function(){return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(r.Xz,{children:(0,m.jsx)(s.wI,{broadphase:"SAP",gravity:[0,-2.6,0],children:(0,m.jsx)(E,{})})}),(0,m.jsxs)("div",{className:"controls",style:{opacity:.5},children:[(0,m.jsx)("p",{children:"press w a s d to move"}),(0,m.jsx)("p",{children:"press k to swap camera"}),(0,m.jsx)("p",{children:"press r to reset"}),(0,m.jsx)("p",{children:"press arrows for flips"})]})]})})}}]);
//# sourceMappingURL=138.49c6971a.chunk.js.map